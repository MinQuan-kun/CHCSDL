-- 27. Cho biết mã số, họ tên, ngày sinh, địa chỉ và vị trí của các cầu thủ thuộc đội
-- bóng “SHB Đà Nẵng” có quốc tịch “Bra-xin”.
USE QLBongDa
GO

CREATE VIEW [SHB Đà Nẵng] AS 
SELECT 
    CT.MACT,
    CT.HOTEN,
	CT.DIACHI,
    CT.NGAYSINH,
	CT.VITRI
FROM CAULACBO CLB
JOIN CAUTHU CT ON CT.MACLB = CLB.MACLB
JOIN QUOCGIA QG ON QG.MAQG = CT.MAQG
WHERE CLB.TENCLB LIKE N'SHB Đà Nẵng'
AND QG.TENQG LIKE N'Bra-xin'
GO
SELECT *
FROM [SHB Đà Nẵng]
--DROP VIEW [SHB Đà Nẵng]

-- 28. Cho biết kết quả (MATRAN, NGAYTD, TENSAN, TENCLB1, TENCLB2,
-- KETQUA) các trận đấu vòng 3 của mùa bóng năm 2009.
USE QLBongDa
GO
CREATE VIEW KETQUA2009 AS
SELECT TD.MATRAN,
	NGAYTD,
	S.TENSAN,
	CLB1.TENCLB AS TENCLB1,
	CLB2.TENCLB AS TENCLB2,
	TD.KETQUA
FROM TRANDAU TD
JOIN SANVD S ON S.MASAN = TD.MASAN
JOIN CAULACBO AS CLB1 ON CLB1.MACLB = TD.MACLB1
JOIN CAULACBO AS CLB2 ON CLB2.MACLB = TD.MACLB2
WHERE TD.VONG = 3 AND TD.NAM = 2009
GO
SELECT * FROM KETQUA2009
--DROP VIEW KETQUA200

-- 29. Cho biết mã huấn luyện viên, họ tên, ngày sinh, địa chỉ, vai trò và tên CLB
-- đang làm việc của các huấn luyện viên có quốc tịch “Việt Nam”.
USE QLBongDa
GO
CREATE VIEW HLVVN AS
SELECT HLV.MAHLV,
	TENHLV,
	NGAYSINH,
	DIACHI,
	HLVCLB.VAITRO,
	CLB.TENCLB
FROM HUANLUYENVIEN HLV
JOIN HLV_CLB HLVCLB ON HLVCLB.MAHLV = HLV.MAHLV
JOIN CAULACBO CLB ON CLB.MACLB = HLVCLB.MACLB
JOIN QUOCGIA QG ON QG.MAQG = HLV.MAQG
WHERE QG.TENQG LIKE N'Việt Nam'
GO
SELECT * FROM  HLVVN
-- DROP VIEW HLVVN

-- 30. Cho biết mã câu lạc bộ, tên câu lạc bộ, tên sân vận động, địa chỉ và số lượng
-- cầu thủ nước ngoài (có quốc tịch khác “Việt Nam”) tương ứng của các câu lạc bộ
-- có nhiều hơn 2 cầu thủ nước ngoài.
USE QLBongDa 
GO
CREATE VIEW CLBNN AS
SELECT CLB.MACLB,
	TENCLB,
	S.TENSAN,
	S.DIACHI,
	COUNT(CT.MACT) AS "Cầu thủ nước ngoài"
FROM CAULACBO CLB
JOIN SANVD S ON S.MASAN = CLB.MASAN
JOIN CAUTHU CT ON CT.MACLB = CLB.MACLB
JOIN QUOCGIA QG ON QG.MAQG = CT.MAQG
WHERE QG.TENQG NOT LIKE N'Việt Nam'
GROUP BY CLB.MACLB,
	TENCLB,
	S.TENSAN,
	S.DIACHI
HAVING COUNT(CT.MACT) > 2
GO 
SELECT * FROM CLBNN
-- DROP VIEW CLBNN

-- 31. Cho biết tên tỉnh, số lượng cầu thủ đang thi đấu ở vị trí tiền đạo trong các câu lạc
-- bộ thuộc địa bàn tỉnh đó quản lý.
USE QLBongDa
GO
CREATE VIEW TINHCLB AS
SELECT T.TENTINH,
COUNT(CT.MACT) AS "Số lượng cầu thủ"
FROM TINH T
JOIN CAULACBO CLB ON CLB.MATINH = T.MATINH
JOIN CAUTHU CT ON CT.MACLB = CLB.MACLB
WHERE CT.VITRI LIKE N'Tiền đạo'
GROUP BY T.TENTINH
GO
SELECT *
FROM TINHCLB
-- DROP VIEW TINHCLB

-- 32. Cho biết tên câu lạc bộ, tên tỉnh mà CLB đang đóng nằm ở vị trí cao nhất của
-- bảng xếp hạng của vòng 3, năm 2009.
CREATE VIEW TOP1CLB AS
SELECT TOP 1
	CLB.TENCLB,
	T.TENTINH,
	SUM(BXH.DIEM) AS "Tổng điểm"
FROM BANGXH BXH
JOIN CAULACBO CLB ON CLB.MACLB = BXH.MACLB
JOIN TINH T ON T.MATINH = CLB.MATINH
WHERE BXH.VONG = 3 AND BXH.NAM = 2009
GROUP BY CLB.TENCLB, T.TENTINH
ORDER BY SUM(BXH.DIEM) DESC

--Cách này nhanh hơn :D
CREATE VIEW TOP1CLB AS
SELECT 
	CLB.TENCLB,
	T.TENTINH
	--SUM(BXH.DIEM) AS "Tổng điểm"
FROM BANGXH BXH
JOIN CAULACBO CLB ON CLB.MACLB = BXH.MACLB
JOIN TINH T ON T.MATINH = CLB.MATINH
WHERE BXH.VONG = 3 AND BXH.NAM = 2009 AND BXH.HANG = 1
GROUP BY CLB.TENCLB, T.TENTINH
SELECT * 
FROM TOP1CLB
-- DROP VIEW TOP1CLB

-- 33. Cho biết tên huấn luyện viên đang nắm giữ một vị trí trong một câu lạc bộ mà
-- chưa có số điện thoại.
CREATE VIEW HLVKHONGCOSDT AS
SELECT HLV.TENHLV
FROM HUANLUYENVIEN HLV
JOIN HLV_CLB HLVCLB ON HLVCLB.MAHLV = HLV.MAHLV
WHERE HLVCLB.VAITRO IS NOT NULL
AND HLV.DIENTHOAI IS NULL
SELECT * FROM HLVKHONGCOSDT 
-- DROP VIEW HLVKHONGCOSDT